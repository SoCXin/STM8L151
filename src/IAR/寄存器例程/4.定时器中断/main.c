/*******************************************************************************
*******************************蓝旗嵌入式系统***********************************
*************************http://lenchimcu.taobao.com****************************
*******************************************************************************/

#include"iostm8l151k4.h"
#define LED_PORT PA_ODR_ODR6 //LED端口
unsigned char i=0;
/*******************************************************************************
****入口参数：无
****出口参数：无
****函数备注：GPIO配置，配置PA6输出
****版权信息：蓝旗嵌入式系统
*******************************************************************************/
void Init_GPIO(void)
{
       PA_DDR_DDR6 = 1;//PA6输出
       PA_CR1_C16 = 1; //推挽输出
       PA_CR2_C26 = 0;//输出速率2M
}
/*******************************************************************************
****入口参数：无
****出口参数：无
****函数备注：定时器配置，配置定时器4，大约1S中断一次
****版权信息：蓝旗嵌入式系统
*******************************************************************************/
void Init_Timer4(void)
{
    CLK_PCKENR1=0x04; //L系列外设时钟默认关闭，需打开
    TIM4_EGR=0x01;    //计数器更新
    TIM4_PSCR=0x07;//分频值
    TIM4_CNTR=255;//计数器值
    TIM4_ARR=255;//自动重装的值
    TIM4_CR1=0x01;//使能计数器
    TIM4_IER=0x01;//更新中断使能
    

}
/*******************************************************************************
****入口参数：无
****出口参数：无
****函数备注：定时器4中断处理函数，大约1S取反LED端口一次
****版权信息：蓝旗嵌入式系统
*******************************************************************************/
#pragma vector=TIM4_UIF_vector
__interrupt void TIM4_UIF_IRQHandler(void)
{
      i++;
      TIM4_SR1=0x00;
      if(i==61)
      {
	  LED_PORT^=1;//异或
	  i=0;
      }
    
}
/*******************************************************************************
****入口参数：无
****出口参数：无
****函数备注：主函数
****版权信息：蓝旗嵌入式系统
*******************************************************************************/
int main( void )
{
    Init_GPIO();
    Init_Timer4();
    asm("rim");//开全局中断
   
    while(1); 

}
/*******************************************************************************
*******************************蓝旗嵌入式系统***********************************
*************************http://lenchimcu.taobao.com****************************
*******************************************************************************/